<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= restaurant.title %> - Local Compass</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      * {
        font-family: "Inter", sans-serif;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInLeft {
        0% {
          opacity: 0;
          transform: translateX(-30px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes gradient-shift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .animate-float {
        animation: float 3s ease-in-out infinite;
      }
      .animate-fadeInUp {
        animation: fadeInUp 0.8s ease-out forwards;
      }
      .animate-slideInLeft {
        animation: slideInLeft 0.8s ease-out forwards;
      }

      .gradient-bg {
        background: linear-gradient(-45deg, #3b82f6, #1d4ed8, #2563eb, #1e40af);
        background-size: 400% 400%;
        animation: gradient-shift 6s ease infinite;
      }

      .glass {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn-success {
        background: linear-gradient(135deg, #10b981, #059669);
        transition: all 0.3s ease;
      }
      .btn-success:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
      }

      .btn-warning {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        transition: all 0.3s ease;
      }
      .btn-warning:hover {
        background: linear-gradient(135deg, #d97706, #b45309);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        transition: all 0.3s ease;
      }
      .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
      }

      .btn-gray {
        background: linear-gradient(135deg, #6b7280, #4b5563);
        transition: all 0.3s ease;
      }
      .btn-gray:hover {
        background: linear-gradient(135deg, #4b5563, #374151);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(107, 114, 128, 0.4);
      }

      #map {
        height: 400px;
        width: 100%;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1);
      }

      .review-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        transition: all 0.3s ease;
      }
      .review-card:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.1);
      }

      .star-rating {
        color: #fcd34d;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      .stagger-1 {
        animation-delay: 0.1s;
      }
      .stagger-2 {
        animation-delay: 0.2s;
      }
      .stagger-3 {
        animation-delay: 0.3s;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-blue-50 via-white to-blue-100 min-h-screen"
  >
    <!-- Minimal Header -->
    <header class="fixed w-full top-0 z-50 glass border-b border-white/20">
      <div class="max-w-7xl mx-auto px-6 py-4 flex justify-center items-center">
        <div class="flex items-center space-x-2">
          <div class="text-2xl">üß≠</div>
          <a
            href="/"
            class="text-2xl font-bold gradient-bg bg-clip-text text-transparent"
          >
            Local Compass
          </a>
        </div>
      </div>
    </header>

    <div class="max-w-4xl mx-auto px-6 pt-28 pb-12">
      <!-- Back Button -->
      <div class="mb-6 text-center animate-fadeInUp">
        <a
          href="/restaurants"
          class="btn-gray text-white px-6 py-3 rounded-xl font-semibold"
        >
          üìã Back to All Restaurants
        </a>
      </div>

      <!-- Restaurant Header -->
      <div class="glass rounded-3xl p-8 shadow-2xl mb-8 animate-fadeInUp">
        <div class="text-center">
          <h1
            class="text-4xl font-bold gradient-bg bg-clip-text text-transparent mb-6"
          >
            <%= restaurant.title %>
          </h1>
          <div class="grid md:grid-cols-2 gap-6 text-left">
            <% if (restaurant.price) { %>
            <div class="flex items-center space-x-3">
              <span class="text-2xl">üí∞</span>
              <div>
                <span class="font-semibold text-gray-700">Price:</span>
                <span class="text-gray-600 ml-2"><%= restaurant.price %></span>
              </div>
            </div>
            <% } %>
            <div class="flex items-center space-x-3">
              <span class="text-2xl">üìç</span>
              <div>
                <span class="font-semibold text-gray-700">Location:</span>
                <span class="text-gray-600 ml-2"
                  ><%= restaurant.location %></span
                >
              </div>
            </div>
            <div class="flex items-center space-x-3">
              <span class="text-2xl">üçΩÔ∏è</span>
              <div>
                <span class="font-semibold text-gray-700">Cuisine:</span>
                <span class="text-gray-600 ml-2"
                  ><%= restaurant.cuisine %></span
                >
              </div>
            </div>
            <div class="flex items-start space-x-3 md:col-span-2">
              <span class="text-2xl mt-1">üìù</span>
              <div>
                <span class="font-semibold text-gray-700">Description:</span>
                <p class="text-gray-600 ml-2 mt-1">
                  <%= restaurant.description %>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div
        class="glass rounded-2xl p-6 shadow-xl mb-8 animate-fadeInUp stagger-1"
      >
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
          <span class="text-3xl mr-3">üó∫Ô∏è</span>
          Location Map
        </h2>
        <div id="map"></div>
      </div>

      <!-- Reviews Section -->
      <div
        class="glass rounded-2xl p-6 shadow-xl mb-8 animate-fadeInUp stagger-2"
      >
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="text-3xl mr-3">‚≠ê</span>
          Reviews
        </h2>

        <!-- Existing Reviews -->
        <div class="space-y-4 mb-8">
          <% restaurant.reviews.forEach((review, index) => { %>
          <div class="review-card rounded-xl p-4 animate-fadeInUp">
            <p class="text-gray-700 mb-3 leading-relaxed"><%= review.body %></p>
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                <span class="star-rating text-lg">
                  <% for(let i = 1; i <= 5; i++) { %> <%= i <= review.rating ?
                  '‚≠ê' : '‚òÜ' %> <% } %>
                </span>
                <span class="text-sm text-gray-600"
                  >(<%= review.rating %>/5)</span
                >
              </div>
              <% if (isAdmin) { %>
              <form
                action="/restaurants/<%= restaurant._id %>/reviews/<%= review._id %>?_method=DELETE"
                method="POST"
                class="inline"
              >
                <button
                  type="submit"
                  class="btn-danger text-white px-3 py-1 rounded-lg text-sm font-medium"
                  onclick="return confirm('Delete this review?')"
                >
                  üóëÔ∏è Delete
                </button>
              </form>
              <% } %>
            </div>
          </div>
          <% }) %>
        </div>

        <!-- Add Review Form -->
        <div class="border-t border-white/20 pt-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">
            Add Your Review
          </h3>
          <form
            action="/restaurants/<%= restaurant._id %>/reviews"
            method="POST"
            class="space-y-4"
          >
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Your Review</label
              >
              <textarea
                name="body"
                rows="4"
                placeholder="Share your experience..."
                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
                required
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Rating</label
              >
              <select
                name="rating"
                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
              >
                <option value="1">‚≠ê 1 - Poor</option>
                <option value="2">‚≠ê‚≠ê 2 - Fair</option>
                <option value="3">‚≠ê‚≠ê‚≠ê 3 - Good</option>
                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4 - Very Good</option>
                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 - Excellent</option>
              </select>
            </div>

            <button
              type="submit"
              class="btn-success text-white px-6 py-3 rounded-xl font-semibold"
            >
              ‚ú® Submit Review
            </button>
          </form>
        </div>
      </div>

      <!-- Admin Edit Button -->
      <div
        class="flex flex-wrap gap-4 justify-center animate-fadeInUp stagger-3"
      >
        <% if (isAdmin) { %>
        <a
          href="/restaurants/<%= restaurant._id %>/edit"
          class="btn-warning text-white px-6 py-3 rounded-xl font-semibold"
        >
          ‚úèÔ∏è Edit Restaurant
        </a>
        <% } %>
      </div>
    </div>

    <!-- Footer -->
    <footer class="glass border-t border-white/20 py-8 mt-20">
      <div class="max-w-7xl mx-auto px-6 text-center">
        <div class="flex items-center justify-center mb-4">
          <div class="text-2xl mr-2">üß≠</div>
          <span
            class="text-xl font-bold gradient-bg bg-clip-text text-transparent"
          >
            Local Compass
          </span>
        </div>
        <p class="text-gray-600 mb-2">
          &copy; 2025 Local Compass. All rights reserved.
        </p>
        <p class="text-gray-500">Made with ‚ù§Ô∏è for food lovers everywhere</p>
      </div>
    </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const lat = parseFloat("<%= restaurant.lat %>") || 24.4539;
      const lng = parseFloat("<%= restaurant.lng %>") || 50.0988;

      const map = L.map("map").setView([lat, lng], 16);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);

      L.marker([lat, lng])
        .addTo(map)
        .bindPopup(
          `
          <div class="text-center">
            <h3 class="font-bold text-blue-600 mb-2"><%= restaurant.title %></h3>
            <p class="text-sm text-gray-600">üìç <%= restaurant.location %></p>
            <p class="text-sm text-gray-500 mt-1">üß≠ <%= restaurant.cuisine %></p>
          </div>
        `
        )
        .openPopup();

      // Intersection Observer for animations
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = "1";
              entry.target.style.transform = "translateY(0)";
            }
          });
        },
        { threshold: 0.1, rootMargin: "0px 0px -50px 0px" }
      );

      document.querySelectorAll(".animate-fadeInUp").forEach((el) => {
        el.style.opacity = "0";
        el.style.transform = "translateY(30px)";
        observer.observe(el);
      });

      // Review form validation
      const reviewForm = document.querySelector('form[action*="/reviews"]');
      if (reviewForm) {
        reviewForm.addEventListener("submit", function (e) {
          const textarea = this.querySelector('textarea[name="body"]');
          if (textarea.value.trim().length < 5) {
            e.preventDefault();
            alert("Please write a review with at least 5 characters.");
            textarea.focus();
          }
        });
      }
    </script>
  </body>
</html>
