<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All Restaurants - Local Compass</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      * {
        font-family: "Inter", sans-serif;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInLeft {
        0% {
          opacity: 0;
          transform: translateX(-30px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes gradient-shift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .animate-float {
        animation: float 3s ease-in-out infinite;
      }

      .animate-fadeInUp {
        animation: fadeInUp 0.8s ease-out forwards;
      }

      .animate-slideInLeft {
        animation: slideInLeft 0.8s ease-out forwards;
      }

      .gradient-bg {
        background: linear-gradient(-45deg, #3b82f6, #1d4ed8, #2563eb, #1e40af);
        background-size: 400% 400%;
        animation: gradient-shift 6s ease infinite;
      }

      .glass {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(255, 255, 255, 0.2);
      }

      .admin-badge {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-left: 8px;
      }

      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .card-hover:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
      }

      .nav-link {
        position: relative;
        overflow: hidden;
      }

      .nav-link::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: #3b82f6;
        transition: width 0.3s ease;
      }

      .nav-link:hover::after {
        width: 100%;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
      }

      .user-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 1rem;
        font-weight: 500;
        font-size: 0.875rem;
      }

      .admin-badge {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      }

      .user-badge-regular {
        background: rgba(107, 114, 128, 0.1);
        color: #374151;
        border: 1px solid rgba(107, 114, 128, 0.2);
      }

      .logout-btn {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        color: #6b7280;
        background: transparent;
        border: 1px solid rgba(107, 114, 128, 0.2);
      }

      .logout-btn:hover {
        background: #ef4444;
        color: white;
        border-color: #ef4444;
      }

      .stagger-1 { animation-delay: 0.1s; }
      .stagger-2 { animation-delay: 0.2s; }
      .stagger-3 { animation-delay: 0.3s; }
      .stagger-4 { animation-delay: 0.4s; }
      .stagger-5 { animation-delay: 0.5s; }
      .stagger-6 { animation-delay: 0.6s; }
      .stagger-7 { animation-delay: 0.7s; }
      .stagger-8 { animation-delay: 0.8s; }
      .stagger-9 { animation-delay: 0.9s; }
      .stagger-10 { animation-delay: 1s; }
      .stagger-11 { animation-delay: 1.1s; }
      .stagger-12 { animation-delay: 1.2s; }

      .filter-dropdown {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(59, 130, 246, 0.2);
        transition: all 0.3s ease;
      }

      .filter-dropdown:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .filter-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-white to-blue-100 min-h-screen">
    <!-- Navigation -->
    <nav class="fixed w-full top-0 z-50 glass border-b border-white/20">
      <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-2 animate-slideInLeft">
            <div class="text-2xl mr-2">🧭</div>
            <h1 class="text-2xl font-bold gradient-bg bg-clip-text text-transparent">
              Local Compass
            </h1>
          </div>

          <!-- Center section with navigation links -->
          <div class="hidden md:flex">
            <ul class="flex space-x-8 font-medium">
              <li>
                <a href="/" class="nav-link text-gray-700 hover:text-blue-600 transition-colors duration-300 stagger-1 animate-fadeInUp">Home</a>
              </li>
              <li>
                <a href="/restaurants" class="nav-link text-blue-600 font-semibold transition-colors duration-300 stagger-2 animate-fadeInUp">Restaurants</a>
              </li>
              <li>
                <a href="/contact" class="nav-link text-gray-700 hover:text-blue-600 transition-colors duration-300 stagger-4 animate-fadeInUp">Contact</a>
              </li>
            </ul>
          </div>

          <!-- Right section with action buttons -->
          <div class="hidden md:flex items-center space-x-4 animate-slideInRight">
            <div class="flex items-center mr-4">
              <!-- User avatar/icon -->
              <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold text-sm relative mr-3">
                <%= currentUser.fullName.charAt(0).toUpperCase() %>
                <% if (isAdmin) { %>
                <div class="absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full border border-white"></div>
                <% } %>
              </div>

              <div class="text-right">
                <div class="text-sm font-semibold text-blue-600 flex items-center">
                  <%= currentUser.fullName %>
                  <% if (isAdmin) { %>
                  <span class="admin-badge ml-2">Admin</span>
                  <% } %>
                </div>
              </div>
            </div>

            <form action="/logout" method="POST" class="inline">
              <button type="submit" class="btn-secondary px-4 py-2 text-gray-700 rounded-lg text-sm font-semibold hover:text-red-600 hover:bg-red-50 transition-all duration-300">
                Logout
              </button>
            </form>
          </div>

          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-button" class="text-gray-700 hover:text-blue-600 transition-colors">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="md:hidden hidden mt-4 pb-4">
          <div class="flex flex-col space-y-3">
            <a href="/" class="text-gray-700 hover:text-blue-600 transition-colors">Home</a>
            <a href="/restaurants" class="text-blue-600 font-semibold">Restaurants</a>
            <a href="/contact" class="text-gray-700 hover:text-blue-600 transition-colors">Contact</a>

            <!-- Mobile user info -->
            <div class="border-b pb-3 mb-3">
              <div class="flex items-center justify-center mb-2">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold relative mr-3">
                  <%= currentUser.fullName.charAt(0).toUpperCase() %>
                  <% if (isAdmin) { %>
                  <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full border border-white"></div>
                  <% } %>
                </div>
                <div class="text-center">
                  <div class="text-sm font-semibold text-gray-800 flex items-center justify-center">
                    <%= currentUser.fullName %>
                    <% if (isAdmin) { %>
                    <span class="admin-badge ml-2">Admin</span>
                    <% } %>
                  </div>
                </div>
              </div>
            </div>

            <% if (isAdmin) { %>
            <a href="/restaurants/new" class="block text-blue-600 hover:text-blue-700 transition-colors py-1 font-semibold text-center">+ Add Restaurant</a>
            <% } %>
            
            <form action="/logout" method="POST" class="mt-2">
              <button type="submit" class="w-full text-red-600 hover:text-red-700 transition-colors py-1">
                Logout
              </button>
            </form>
          </div>
        </div>
      </div>
    </nav>

    <div class="max-w-6xl mx-auto px-6 pt-28 pb-12">
      <!-- Header Section -->
      <div class="text-center mb-8 animate-fadeInUp">
        <div class="glass rounded-3xl p-8 shadow-2xl">
          <div class="text-5xl mb-4 animate-float">🍽️</div>
          <h1 class="text-4xl font-bold gradient-bg bg-clip-text text-transparent mb-4">
            Restaurant Directory
          </h1>
          <p class="text-lg text-gray-600 mb-6">
            Discover amazing restaurants in our community
          </p>
          <!-- Only show Add Restaurant button for admin users -->
          <% if (isAdmin) { %>
          <a href="/restaurants/new" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold shadow-lg inline-flex items-center gap-2">
            <span class="text-lg">+</span>
            Add Restaurant
          </a>
          <% } %>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="mb-8 animate-fadeInUp">
        <div class="filter-section rounded-2xl p-6 shadow-xl">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3">
              <span class="text-2xl">📍</span>
              <h3 class="text-lg font-semibold text-gray-700">Filter by Location:</h3>
            </div>

            <div class="flex items-center gap-3">
              <form id="locationFilterForm" method="GET" action="/restaurants" class="flex items-center gap-3">
                <select name="location" id="locationSelect" class="filter-dropdown px-4 py-2 rounded-xl font-medium text-gray-700 min-w-48" onchange="this.form.submit()">
                  <option value="">All Locations</option>
                  <option value="Dammam" <%= selectedLocation === 'Dammam' ? 'selected' : '' %>>Dammam</option>
                  <option value="Al Khobar" <%= selectedLocation === 'Al Khobar' ? 'selected' : '' %>>Al Khobar</option>
                  <option value="Amman" <%= selectedLocation === 'Amman' ? 'selected' : '' %>>Amman</option>
                </select>
              </form>

              <!-- Clear filter button (shown only when filter is active) -->
              <% if (selectedLocation) { %>
              <a href="/restaurants" id="clearFilter" class="btn-secondary px-4 py-2 rounded-xl text-sm font-semibold text-gray-600 hover:text-gray-800 transition-all duration-300">
                Clear Filter
              </a>
              <% } %>
            </div>
          </div>

          <!-- Results count -->
          <div id="resultsCount" class="mt-4 text-center text-gray-600 font-medium">
            Showing <span id="restaurantCount"><%= restaurants.length %></span> restaurants
          </div>
        </div>
      </div>

      <!-- Restaurant Cards -->
      <% if (restaurants.length > 0) { %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="restaurantGrid">
        <% restaurants.forEach((r, index) => { %>
        <div class="glass rounded-2xl shadow-xl card-hover animate-fadeInUp stagger-<%= (index % 12) + 1 %>" data-location="<%= r.location %>">
          <!-- Restaurant Header -->
          <div class="h-32 gradient-bg rounded-t-2xl flex items-center justify-center">
            <span class="text-white text-2xl font-bold"><%= r.cuisine %></span>
          </div>

          <!-- Card Content -->
          <div class="p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-3"><%= r.title %></h3>
            <p class="text-gray-600 text-sm mb-4 flex items-center">
              <span class="text-lg mr-2">📍</span>
              <%= r.location %>
            </p>

            <!-- Action Buttons -->
            <div class="flex gap-2">
              <!-- View button - available for all users -->
              <a href="/restaurants/<%= r._id %>" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:shadow-lg flex-1 text-center">
                View
              </a>

              <!-- Edit and Delete buttons - only for admin users -->
              <% if (isAdmin) { %>
              <a href="/restaurants/<%= r._id %>/edit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:shadow-lg">
                ✏️
              </a>
              <form action="/restaurants/<%= r._id %>?_method=DELETE" method="POST" class="inline">
                <button type="submit" onclick="return confirm('Delete this restaurant?')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:shadow-lg">
                  🗑️
                </button>
              </form>
              <% } %>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } else { %>
      <!-- Empty State -->
      <div id="emptyState" class="text-center py-16 animate-fadeInUp">
        <div class="glass rounded-3xl p-12 shadow-2xl">
          <div class="text-6xl mb-6 animate-float">🔍</div>
          <h2 class="text-3xl font-bold text-gray-600 mb-4">No restaurants found</h2>
          <p class="text-gray-500 mb-6 text-lg">
            <% if (selectedLocation) { %>
            No restaurants found in <%= selectedLocation %>. Try selecting a different location or clear the filter.
            <% } else { %>
            No restaurants available at the moment.
            <% } %>
          </p>
          <a href="/restaurants" class="btn-primary text-white px-8 py-4 rounded-xl text-lg font-semibold shadow-lg">
            View All Restaurants
          </a>
        </div>
      </div>
      <% } %>
    </div>

    <!-- Footer -->
    <footer class="glass border-t border-white/20 py-8 mt-20">
      <div class="max-w-7xl mx-auto px-6 text-center">
        <div class="flex items-center justify-center mb-4">
          <div class="text-2xl mr-2">🧭</div>
          <span class="text-xl font-bold gradient-bg bg-clip-text text-transparent">Local Compass</span>
        </div>
        <p class="text-gray-600 mb-2">&copy; 2025 Local Compass. All rights reserved.</p>
        <p class="text-gray-500">Made with ❤️ for food lovers everywhere</p>
      </div>
    </footer>

    <script>
      // Mobile menu toggle
      document.getElementById("mobile-menu-button").addEventListener("click", function () {
        const mobileMenu = document.getElementById("mobile-menu");
        mobileMenu.classList.toggle("hidden");
      });

      // Smooth scrolling for navigation links
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute("href"));
          if (target) {
            target.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          }
        });
      });

      // Add scroll effect to navbar
      let lastScrollY = 0;
      window.addEventListener("scroll", () => {
        const nav = document.querySelector("nav");
        const currentScrollY = window.scrollY;

        if (currentScrollY > 100) {
          nav.style.background = "rgba(255, 255, 255, 0.98)";
          nav.style.backdropFilter = "blur(20px)";
        } else {
          nav.style.background = "rgba(255, 255, 255, 0.95)";
          nav.style.backdropFilter = "blur(15px)";
        }

        lastScrollY = currentScrollY;
      });

      // Intersection Observer for animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = "1";
            entry.target.style.transform = "translateY(0)";
          }
        });
      }, observerOptions);

      // Observe all animated elements
      document.querySelectorAll(".animate-fadeInUp").forEach((el) => {
        el.style.opacity = "0";
        el.style.transform = "translateY(30px)";
        observer.observe(el);
      });
    </script>
  </body>
</html>